import { StatusEffect } from "../StatusEffect";
import type { BasePlayer } from "../BasePlayer";
import { Logger } from "@/utils/Logger";
import { Priority } from "@/config/priorities";

const logger = Logger.getInstance();

export class Invulnerability extends StatusEffect {
  static override priority: number = Priority.CRITICAL;
  static override displayName: string = "Invulnerability";
  static override description: string = "Immune to all damage";

  constructor(target: BasePlayer, duration: number | null = null) {
    super(target, duration);
  }

  onApply(gameTime: number): void {
    this.isActive = true;
    this.startTime = gameTime;

    if (this.duration !== null) {
      this.endTime = gameTime + this.duration;
    }

    this.target.isInvulnerable = true;

    logger.info("STATUS", `${this.target.name} became invulnerable`, {
      duration: this.duration,
      endTime: this.endTime,
    });
  }

  onRemove(gameTime: number): void {
    this.isActive = false;
    this.target.isInvulnerable = false;

    logger.info("STATUS", `${this.target.name} lost invulnerability`);
  }

  modifyIncomingDamage(damage: number): number {
    logger.debug("STATUS", `Invulnerability blocked ${damage} damage`, {
      target: this.target.name,
    });
    return 0;
  }
}
